(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"013f":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",[a("q-page-container",[a("q-page",{staticClass:"flex flex-center login-page"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.appUpdater.isLatest,expression:"appUpdater.isLatest"}]},[a("div",{staticClass:"logo"})]),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.appUpdater.isLatest,expression:"!appUpdater.isLatest"}]},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.appUpdater.isAndroid,expression:"appUpdater.isAndroid"}],staticStyle:{"text-align":"center"}},[a("h5",{staticStyle:{"margin-bottom":"0"}},[t._v(t._s(t.appUpdater.updateTitle))]),a("q-linear-progress",{staticStyle:{height:"20px"},attrs:{value:t.appUpdater.downloadProcessValue/100,rounded:""}},[a("div",{staticClass:"absolute-full flex flex-center"},[a("q-badge",{attrs:{color:"white","text-color":"accent",label:t.appUpdater.downloadProcessValue+"%"}})],1)])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.appUpdater.isAndroid,expression:"!appUpdater.isAndroid"}],staticStyle:{"text-align":"center"}},[a("h5",{staticStyle:{"margin-bottom":"0"}},[t._v(t._s(t.appUpdater.updateTitle))]),a("q-linear-progress",{staticStyle:{height:"20px"},attrs:{value:t.appUpdater.downloadProcessValue/100,rounded:""}},[a("div",{staticClass:"absolute-full flex flex-center"},[a("q-badge",{attrs:{color:"white","text-color":"accent",label:t.appUpdater.downloadProcessValue+"%"}})],1)])],1)]),a("div",{staticClass:"version"},[a("p",[t._v(t._s("Version: "+t.appUpdater.version))])])])],1)],1)},s=[],o=a("2b0e"),i=a("bc3a"),n=a.n(i),c=o["a"].extend({name:"Login",data(){return{appUpdater:{isLatest:!1,isAndroid:!1,updateTitle:"Checking new version ...",updateBaseUrl:"https://rciupdatetest.azurewebsites.net/RCAppsHome",appName:"VirtualVisitor",version:"1.0.0",downloadProcessValue:0}}},methods:{onLogin(){this.$router.push({name:"Dashboard"})},autoLogin(){this.onLogin()},checkVersion(t){this.$q.platform.is.android?this.appUpdater.isAndroid=!0:this.appUpdater.isAndroid=!1,this.appUpdater.isAndroid?this.checkAndroidVersion(e=>{e?this.updateApp():t()}):this.checkIOSVersion(e=>{e?this.updateApp():t()})},checkAndroidVersion(t){const e=`${this.appUpdater.updateBaseUrl}/${this.appUpdater.appName}/${this.appUpdater.appName}.txt`;n.a.get(e).then(e=>{const a=e.data.Version;a!=this.appUpdater.version?(this.appUpdater.updateTitle="Downloading new version...",t(!0)):t(!1)}).catch(t=>{this.showUpdateError(t.message)})},checkIOSVersion(t){const e=`${this.appUpdater.updateBaseUrl}/${this.appUpdater.appName}/${this.appUpdater.appName}.plist`;n.a.get(e).then(e=>{let a="";const r=e.data.split(/\r\n|[\r\n]/);for(let t=0;t<r.length;t++){const e=r[t];if(e.endsWith("<key>bundle-version</key>")&&t+1<r.length){const e=r[t+1].indexOf("<string>");a=r[t+1].substring(e+8,e+8+5)}}a.length>0&&a!=this.appUpdater.version?(this.appUpdater.updateTitle="Updating the App, please wait...",t(!0)):t(!1)}).catch(t=>{this.showUpdateError(t.message)})},updateApp(){if(this.appUpdater.isAndroid){const t=(new Date).getTime(),e=`${this.appUpdater.updateBaseUrl}/${this.appUpdater.appName}/${this.appUpdater.appName}.apk?v=${t}`;this.updateAndroid(e)}else{const t=`itms-services://?action=download-manifest&url=${this.appUpdater.updateBaseUrl}/${this.appUpdater.appName}/${this.appUpdater.appName}.plist`;this.updateIOS(t)}},updateAndroid(t){const e=this;window.resolveLocalFileSystemURL(cordova.file.externalDataDirectory,(function(a){a.getFile(e.appUpdater.appName+".apk",{create:!0,exclusive:!1},(function(a){n()({method:"GET",url:t,responseType:"blob",onDownloadProgress(t){t.lengthComputable&&e.$nextTick(()=>{e.appUpdater.downloadProcessValue=Math.round(t.loaded/t.total*100)})}}).then(t=>{const e=new Blob([t.data],{type:"application/vnd.android.package-archive"});a.createWriter((function(t){t.onwriteend=function(){cordova.plugins.fileOpener2.open(a.toInternalURL(),"application/vnd.android.package-archive")},t.write(e)}))}).catch(t=>{e.showUpdateError("download error: "+t.message)})}),t=>{e.showUpdateError("error getting file! "+t.message)})}),t=>{e.showUpdateError("error getting persistent fs! "+t.code)})},updateIOS(t){cordova.InAppBrowser.open(t,"_system","location=no"),this.simulateDownloadIOS()},simulateDownloadIOS(){setTimeout(()=>{this.appUpdater.downloadProcessValue>=100?cordova.plugins.exit():(this.$nextTick(()=>{this.appUpdater.downloadProcessValue+=10}),this.simulateDownloadIOS())},1e3)},showUpdateError(t){navigator.notification.alert(t,()=>{cordova.plugins.exit()})}},mounted(){this.$q.platform.is.cordova?this.checkVersion(()=>{this.appUpdater.isLatest=!0,this.autoLogin()}):(this.appUpdater.isLatest=!0,this.autoLogin())}}),d=c,l=(a("fbe0"),a("2c53"),a("2877")),p=Object(l["a"])(d,r,s,!1,null,"e39a17d6",null);e["default"]=p.exports},"0221":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fixed-center text-center"},[a("h3",[t._v(t._s(t.title))]),a("p",[t._v(t._s(t.message))]),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.showBack,expression:"showBack"}],staticClass:"full-width fixed-center",attrs:{color:"primary",icon:"camera",label:"Back to Dashboard"},on:{click:t.onBackToDashboard}})],1)},s=[],o=a("2b0e"),i=o["a"].extend({name:"ErrorInfo",data(){return{title:"",message:"",showBack:!1}},methods:{onBackToDashboard(){this.$router.replace({name:"Dashboard"})}},mounted(){const t=this.$store.getters["MessageStore/GET_MESSAGE"];this.title=t.title,this.message=t.message,this.showBack=this.$q.platform.is.cordova}}),n=i,c=a("2877"),d=Object(c["a"])(n,r,s,!1,null,null,null);e["default"]=d.exports},"24bb":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{attrs:{view:"lHh Lpr lFf"}},[a("q-header",{attrs:{elevated:""}},[a("q-toolbar",[a("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"keyboard_backspace"},on:{click:t.onBack}}),a("q-toolbar-title",[t._v(t._s(t.title))])],1)],1),a("q-page-container",[a("q-page",t._l(t.list,(function(e,r){return a("q-list",{key:r,attrs:{bordered:"",separator:""}},[a("q-slide-item",{on:{left:function(a){return t.onOpenDoor(e.pk,e.isUnLock)},right:function(a){return t.onOpenDoor(e.pk,e.isUnLock)}},scopedSlots:t._u([{key:"left",fn:function(){return[a("div",{staticClass:"row items-center"},[a("q-icon",{attrs:{left:"",name:"lock_open"}}),t._v(" Opening...\n            ")],1)]},proxy:!0},{key:"right",fn:function(){return[a("div",{staticClass:"row items-center"},[t._v("\n              Opening..."),a("q-icon",{attrs:{left:"",name:"lock_open"}})],1)]},proxy:!0}],null,!0)},[a("q-item",{on:{click:function(a){return t.onOpenDoor(e.pk,e.isUnLock)}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{attrs:{color:"primary","text-color":"white",icon:"lock"}})],1),a("q-item-section",[t._v(t._s(e.name))])],1)],1)],1)})),1)],1)],1)},s=[],o=a("2b0e"),i=a("d257"),n=a("2c75");class c{static GetDoorList(t,e,a){const r={encoded:t,readerPK:e,readerType:a};return n["a"].post("BizReader_GetDoorList",r)}static OpenDoor(t,e){const a={doorPK:t,isUnLock:e};return n["a"].post("BizReader_OpenDoor",a)}}var d=o["a"].extend({name:"ReaderDetail",data(){return{title:"Granted Door List",readerType:"",readerPK:"",encoded:0,list:new Array}},methods:{showError(t){this.$q.dialog({title:"Error",message:t})},onBack(){this.$router.back()},showErrorAndBack(t){this.showError(t),this.onBack()},getDoorList(){this.$q.loading.show(),c.GetDoorList(this.encoded,this.readerPK,this.readerType).then(t=>{this.$q.loading.hide(),t.data.ok?this.list=t.data.result:this.showErrorAndBack(t.data.message)}).catch(t=>{this.$q.loading.hide(),this.showErrorAndBack(t.message)})},onOpenDoor(t,e){this.$q.loading.show(),c.OpenDoor(t,e).then(t=>{this.$q.loading.hide(),t.data.ok?(this.$q.notify("The door has been opened."),this.onBack()):this.showErrorAndBack(t.data.message)}).catch(t=>{this.$q.loading.hide(),this.showErrorAndBack(t.message)})}},mounted(){const t=this.$route.params.id;!t||t.length<33?this.showErrorAndBack("The parameter does not valid."):(this.readerType=t.substring(32),this.readerPK=i["a"].decryptPK(t.substring(0,32)),this.$route.params.code?(this.encoded=Number.parseInt(this.$route.params.code),this.getDoorList()):this.showErrorAndBack("The parameter does not valid."))}}),l=d,p=a("2877"),h=Object(p["a"])(l,r,s,!1,null,"128559b2",null);e["default"]=h.exports},"2c53":function(t,e,a){"use strict";var r=a("b47d"),s=a.n(r);s.a},"2c75":function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));var r=a("bc3a"),s=a.n(r);s.a.defaults.timeout=1e4,s.a.defaults.baseURL="https://d3000apitest.azurewebsites.net/api/VirtualVisitor/",s.a.interceptors.request.use((function(t){const e=sessionStorage.getItem("D3000_VirtualVisitor_authorization")||"";return e&&(t.headers.Authorization="Basic "+e),t.url=t.url+"?access_token=73FBF94A-3F5E-7190-9252-95924D4DBBD2",t}),(function(t){return Promise.reject(t)})),s.a.interceptors.response.use((function(t){return t}),(function(t){return Promise.reject(t)}));class o{static post(t,e,a){return s.a.post(t,e,a)}}},6674:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{attrs:{view:"lHh Lpr lFf"}},[a("q-page-container",[a("q-page",[a("div",{staticClass:"text-center"},[a("h4",[t._v(t._s(t.title))]),a("h5",[t._v("Pre-Registered Visitor Enter Entry Code Here:")]),a("div",[a("q-input",{attrs:{outlined:"",type:"number",autofocus:"",label:"Encoded"},model:{value:t.encoded,callback:function(e){t.encoded=e},expression:"encoded"}}),a("q-btn",{staticClass:"full-width",attrs:{color:"primary",label:"Granted Visitor"},on:{click:t.onGrantedVisitor}})],1),a("h5",[t._v("No Visitor Code?")]),a("h6",[t._v("\n          Call:\n          "),a("strong",[a("a",{attrs:{href:"tel:"+t.zonePhone}},[t._v(t._s(t.zonePhone))])])])])])],1)],1)},s=[],o=a("2b0e"),i=a("d257"),n=a("2c75");class c{static CheckLocation(t){return n["a"].post("BizLogin_CheckLocation",t)}static Login(t,e,a){const r={userId:t,password:e,ticks:a};return n["a"].post("BizLogin_Login",r)}}var d=o["a"].extend({name:"ReaderDetail",data(){return{title:"",readType:"",readerPK:"",encoded:0,watchGPSID:0,zonePhone:""}},methods:{toErrorPage(t){this.$store.commit("MessageStore/SET_MESSAGE",{title:"Error",message:t}),this.$router.replace({name:"ErrorInfo"})},onGrantedVisitor(){if(!this.encoded)return void this.$q.dialog({title:"Error",message:"Please enter the encoded firstly."});const t=i["a"].encryptPK(this.readerPK)+this.readType,e=this.encoded.toString();this.$router.push({name:"DoorList",params:{id:t,code:e}})},getGPSPosition(t){try{this.$q.loading.show(),this.watchGPSID=navigator.geolocation.watchPosition(e=>{this.$q.platform.is.ios&&e.coords.accuracy>30||(navigator.geolocation.clearWatch(this.watchGPSID),this.$q.loading.hide(),t(e.coords.latitude,e.coords.longitude))},t=>{this.$q.loading.hide(),this.toErrorPage("The location service must be enabled.("+t.message+")")},{maximumAge:6e4,timeout:3e4,enableHighAccuracy:!0})}catch(e){this.$q.loading.hide(),this.toErrorPage(e.message)}},checkLocation(t,e){this.$q.loading.show();const a="D3000.VirtualVisitor",r=i["a"].getTicks().toString(),s=i["a"].encryptPassword(r,"7E57C707-F028-45C1-9F80-625A70A60D22");c.CheckLocation({userId:a,password:s,ticks:r,readerPK:this.readerPK,latitude:t,longitude:e}).then(t=>{this.$q.loading.hide(),t.data.ok?(i["a"].setAuthorization(t.data.authorization),this.title=t.data.address,this.zonePhone=t.data.zonePhone):this.toErrorPage(t.data.message)}).catch(t=>{this.$q.loading.hide(),this.toErrorPage(t.message)})}},mounted(){const t=this.$route.params.id;!t||t.length<33?this.toErrorPage("The parameter does not valid."):(this.readType=t.substring(32),this.readerPK=i["a"].decryptPK(t.substring(0,32)),this.getGPSPosition((t,e)=>{this.checkLocation(t,e)}))}}),l=d,p=a("2877"),h=Object(p["a"])(l,r,s,!1,null,"fffd8188",null);e["default"]=h.exports},b47d:function(t,e,a){},d257:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));class r{static setAuthorization(t){sessionStorage.setItem("D3000_VirtualVisitor_authorization",t)}static getAuthorization(){return sessionStorage.getItem("D3000_VirtualVisitor_authorization")||""}static clearAuthorization(){sessionStorage.removeItem("D3000_VirtualVisitor_authorization")}static hasAuthorization(){const t=sessionStorage.getItem("D3000_VirtualVisitor_authorization")||"";return t.length>0}static getTicks(){const t=621355968e9,e=1e4;return t+(new Date).getTime()*e}static encryptPassword(t,e){const a=[];for(let r=0;r<e.length;r++)if(r<t.length){const s=e.charCodeAt(r)+t.charCodeAt(r)-35;a.push(s.toString())}else{const t=e.charCodeAt(r)+5;a.push(t.toString())}return a.join(" ")+" "}static encryptPK(t){return t.replace(/-/g,"")}static decryptPK(t){if(32!==t.length)return t;let e=t.substring(0,8);return e+="-",e+=t.substring(8,12),e+="-",e+=t.substring(12,16),e+="-",e+=t.substring(16,20),e+="-",e+=t.substring(20),e}}},d58c:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fixed-center text-center"},[a("h3",[t._v(t._s(t.title))]),a("p",[t._v(t._s(t.message))]),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.showBack,expression:"showBack"}],staticClass:"full-width fixed-center",attrs:{color:"primary",icon:"camera",label:"Back to Dashboard"},on:{click:t.onBackToDashboard}})],1)},s=[],o=a("2b0e"),i=o["a"].extend({name:"SucessInfo",data(){return{title:"",message:"",showBack:!1}},methods:{onBackToDashboard(){this.$router.replace({name:"Dashboard"})}},mounted(){const t=this.$store.getters["MessageStore/GET_MESSAGE"];this.title=t.title,this.message=t.message,this.showBack=this.$q.platform.is.cordova}}),n=i,c=a("2877"),d=Object(c["a"])(n,r,s,!1,null,null,null);e["default"]=d.exports},e558:function(t,e,a){},ec95:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{attrs:{view:"lHh Lpr lFf"}},[a("q-page-container",[a("q-page",{staticClass:"text-center"},[a("q-card",[a("q-card-section",[a("q-btn",{staticClass:"full-width fixed-center",attrs:{color:"primary",icon:"camera",label:"Scan Reader"},on:{click:t.onScanReader}})],1)],1)],1)],1)],1)},s=[],o=a("2b0e"),i=a("b178");class n{static scanQRCode(t){i["b"].is.cordova?cordova.plugins.barcodeScanner.scan(e=>{e.cancelled||t(e.text)},t=>{n.showError("Scanning failed: "+t.message)},{preferFrontCamera:!1,showFlipCameraButton:!0,showTorchButton:!0,torchOn:!0,saveHistory:!0,prompt:"Place a barcode inside the scan area",resultDisplayDuration:500,formats:"QR_CODE",orientation:"portrait",disableAnimations:!0,disableSuccessBeep:!1}):n.showError("Scanning must be in mobile.")}static takePicture(t){i["b"].is.cordova?n.takePictureByCordova(t):i["b"].is.desktop?n.takePictureByDesktop(t):n.takePictureByMobile(t)}static showError(t){i["a"].create({title:"Error",message:t})}static takePictureByCordova(t){const e=navigator.camera;e?e.getPicture(t,()=>{},{quality:45,destinationType:0,sourceType:1,allowEdit:!0,encodingType:0,targetWidth:250,targetHeight:250}):n.showError("The camera does not exist in the cordova.")}static takePictureByDesktop(t){const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*;capture=camera"),e.addEventListener("change",e=>{const a=e.currentTarget;if(!a||!a.files)return;const r=a.files[0];if(!r)return;const s=new FileReader;s.addEventListener("load",e=>{if(!e.target||!e.target.result)return;const a=e.target.result,r=document.createElement("canvas"),s=document.createElement("img");s.addEventListener("error",()=>{alert("Fail to load image(desktop).")}),s.addEventListener("load",()=>{const e=250;r.width=e,r.height=e;const a=r.getContext("2d");if(!a)return;let o,i;a.clearRect(0,0,e,e);let n=0,c=0;s.width>s.height?(o=Math.round(e*s.width/s.height),i=e,n=-Math.round((o-e)/2)):(i=Math.round(e*s.height/s.width),o=e,c=-Math.round((i-e)/2)),a.drawImage(s,n,c,o,i);const d=r.toDataURL("image/jpeg",.5),l=d.substr(23);t(l)},!1),s.setAttribute("src",a)}),s.readAsDataURL(r)}),e.click()}static takePictureByMobile(t){const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*;capture=camera"),e.addEventListener("change",e=>{const a=e.currentTarget;if(!a||!a.files)return;const r=a.files[0];if(!r)return;const s=document.createElement("img");s.addEventListener("error",()=>{alert("Fail to load image(mobile).")}),s.addEventListener("load",()=>{window.URL.revokeObjectURL(s.src);const e=document.createElement("canvas"),a=250;e.width=a,e.height=a;const r=e.getContext("2d");if(!r)return;let o,i;r.clearRect(0,0,a,a);let n=0,c=0;s.width>s.height?(o=Math.round(a*s.width/s.height),i=a,n=-Math.round((o-a)/2)):(i=Math.round(a*s.height/s.width),o=a,c=-Math.round((i-a)/2)),r.drawImage(s,n,c,o,i);const d=e.toDataURL("image/jpeg",.5),l=d.substr(23);t(l)},!1),s.setAttribute("src",window.URL.createObjectURL(r))}),e.click()}}var c=o["a"].extend({name:"Dashboard",data(){return{firstName:"",lastName:""}},methods:{showError(t){this.$q.dialog({title:"Error",message:t})},onScanReader(){if(this.$q.platform.is.cordova)n.scanQRCode(t=>{const e=t.lastIndexOf("/"),a=t.substring(e+1);this.$router.push({name:"ReaderDetail",params:{id:a}})});else{const t="https://d3000apitest.azurewebsites.net/WebSites/#/Dashboard/F8D5218568D6404DA1252EF3CF666F0E2",e=t.lastIndexOf("/"),a=t.substring(e+1);this.$router.push({name:"ReaderDetail",params:{id:a}})}}}}),d=c,l=a("2877"),p=Object(l["a"])(d,r,s,!1,null,"67741fd8",null);e["default"]=p.exports},fbe0:function(t,e,a){"use strict";var r=a("e558"),s=a.n(r);s.a}}]);